<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title><%= title %></title>
		<style>
			/* åŸæœ‰æ ·å¼ä¿æŒä¸å˜ï¼Œè¿™é‡Œä»…åˆ æ‰å’Œä¸‹è½½æŒ‰é’®ç›¸å…³çš„éƒ¨åˆ† */
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
					'Helvetica Neue', Arial, sans-serif;
				background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
				min-height: 100vh;
				color: #333;
				padding: 20px 0;
			}

			.container {
				max-width: 600px;
				margin: 0 auto;
				padding: 0 20px;
			}

			.logo-section {
				text-align: center;
				margin-bottom: 40px;
				animation: fadeInDown 0.8s ease-out;
			}

			.logo {
				font-size: 4rem;
				margin-bottom: 10px;
				filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.1));
			}

			.main-title {
				color: #2c3e50;
				font-size: 2rem;
				font-weight: 700;
				margin-bottom: 8px;
				text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
			}

			.subtitle {
				color: #7f8c8d;
				font-size: 1.1rem;
				font-weight: 400;
			}

			.main-card {
				background: rgba(255, 255, 255, 0.95);
				backdrop-filter: blur(10px);
				border-radius: 24px;
				box-shadow: 0 20px 60px rgba(0, 0, 0, 0.12);
				border: 1px solid rgba(255, 255, 255, 0.2);
				overflow: hidden;
				animation: fadeInUp 0.8s ease-out 0.2s both;
			}

			.card-content {
				padding: 40px 30px;
			}

			.form-group {
				margin-bottom: 30px;
			}

			.form-label {
				display: flex;
				align-items: center;
				margin-bottom: 12px;
				font-weight: 600;
				color: #34495e;
				font-size: 1.1rem;
			}

			.form-label .icon {
				margin-right: 8px;
				font-size: 1.2rem;
			}

			.form-input {
				width: 100%;
				padding: 16px 20px;
				border: 2px solid #e8f0fe;
				border-radius: 16px;
				font-size: 1rem;
				line-height: 1.5;
				transition: all 0.3s ease;
				resize: vertical;
				min-height: 120px;
				font-family: inherit;
				background: #fafbfc;
			}

			.form-input:focus {
				outline: none;
				border-color: #4285f4;
				background: white;
				box-shadow: 0 0 0 4px rgba(66, 133, 244, 0.1);
				transform: translateY(-1px);
			}

			.form-input::placeholder {
				color: #9aa0a6;
				font-size: 0.95rem;
			}

			.button-group {
				display: flex;
				gap: 16px;
				margin-top: 30px;
			}

			.btn {
				flex: 1;
				padding: 16px 24px;
				border: none;
				border-radius: 16px;
				font-size: 1.1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				text-decoration: none;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 8px;
				position: relative;
				overflow: hidden;
			}

			.btn:disabled {
				opacity: 0.6;
				cursor: not-allowed;
			}

			.btn-parse {
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				color: white;
				box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
			}

			.btn-parse:hover:not(:disabled) {
				transform: translateY(-2px);
				box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
			}

			.btn-icon {
				font-size: 1.2rem;
			}

			.loading-spinner {
				width: 20px;
				height: 20px;
				border: 2px solid rgba(255, 255, 255, 0.3);
				border-top: 2px solid white;
				border-radius: 50%;
				animation: spin 1s linear infinite;
				display: none;
			}

			.result-area {
				margin-top: 30px;
				padding: 24px;
				background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
				border-radius: 16px;
				border-left: 4px solid #28a745;
				display: none;
				animation: slideInUp 0.5s ease-out;
			}

			.result-area.error {
				border-left-color: #dc3545;
				background: linear-gradient(135deg, #fff5f5 0%, #fed7d7 100%);
			}

			.result-title {
				font-weight: 600;
				margin-bottom: 12px;
				color: #2c3e50;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.result-content {
				font-family: 'SF Mono', 'Monaco', 'Cascadia Code', 'Roboto Mono', monospace;
				font-size: 0.9rem;
				line-height: 1.6;
				color: #495057;
				white-space: pre-wrap;
				word-break: break-word;
				background: rgba(255, 255, 255, 0.7);
				padding: 16px;
				border-radius: 8px;
				border: 1px solid rgba(0, 0, 0, 0.1);
			}

			.tips-section {
				margin-top: 40px;
				padding: 24px;
				background: rgba(255, 255, 255, 0.8);
				border-radius: 16px;
				border: 1px solid rgba(255, 255, 255, 0.3);
				animation: fadeInUp 0.8s ease-out 0.4s both;
			}

			.tips-title {
				font-size: 1.1rem;
				font-weight: 600;
				color: #2c3e50;
				margin-bottom: 16px;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.tips-list {
				list-style: none;
			}

			.tips-list li {
				color: #5a6c7d;
				line-height: 1.6;
				margin-bottom: 8px;
				display: flex;
				align-items: flex-start;
				gap: 8px;
			}

			.tips-list li::before {
				content: 'ğŸ’¡';
				flex-shrink: 0;
				margin-top: 2px;
			}

			.tips-section {
				text-align: center;
				margin-top: 20px;
			}

			@keyframes fadeInDown {
				from {
					opacity: 0;
					transform: translateY(-20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@keyframes fadeInUp {
				from {
					opacity: 0;
					transform: translateY(20px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@keyframes slideInUp {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}
		</style>
		<style>
			.image-gallery {
				margin-top: 20px;
				padding: 20px;
				background: rgba(255, 255, 255, 0.9);
				border-radius: 16px;
				box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
				animation: fadeInUp 0.6s ease-out;
			}

			.gallery-title {
				font-size: 1.1rem;
				font-weight: 600;
				color: #2c3e50;
				margin-bottom: 16px;
				display: flex;
				align-items: center;
				gap: 6px;
			}

			.gallery-grid {
				/* display: grid;
				grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
				gap: 12px; */
			}

			.gallery-grid img {
				width: 100%;
				height: auto;
				border-radius: 12px;
				box-shadow: 0 4px 10px rgba(0, 0, 0, 0.12);
				object-fit: cover;
				transition: transform 0.3s ease;
				cursor: pointer;
			}

			.gallery-grid img:hover {
				transform: scale(1.05);
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="logo-section">
				<div class="logo">ğŸµ</div>
				<h1 class="main-title">æŠ–éŸ³è§†é¢‘ä¸‹è½½å™¨</h1>
				<p class="subtitle">å¿«é€Ÿè§£æå¹¶ä¸‹è½½æŠ–éŸ³è§†é¢‘ï¼Œæ”¯æŒæ— æ°´å°ä¸‹è½½</p>
			</div>

			<div class="main-card">
				<div class="card-content">
					<form id="parseForm">
						<div class="form-group">
							<label class="form-label" for="shareText">
								<span class="icon">ğŸ“±</span>
								æŠ–éŸ³åˆ†äº«å†…å®¹
							</label>
							<textarea
								id="shareText"
								class="form-input"
								rows="4"
								placeholder="è¯·ç²˜è´´å®Œæ•´çš„æŠ–éŸ³åˆ†äº«å†…å®¹"
								required
							></textarea>
						</div>

						<div class="button-group">
							<button
								type="button"
								class="btn btn-parse"
								id="parseBtn"
								onclick="parseVideo()"
							>
								<div class="loading-spinner" id="parseSpinner"></div>
								<span class="btn-icon" id="parseIcon">ğŸ”</span>
								<span id="parseText">è§£æè§†é¢‘</span>
							</button>
						</div>

						<!-- è§£æé¢„è§ˆåŒºåŸŸ -->
						<div id="imageGallery" class="image-gallery" style="display: none">
							<div class="gallery-title">ğŸ–¼ï¸ è§£æé¢„è§ˆ</div>
							<div class="gallery-grid" id="galleryGrid"></div>
						</div>

						<div id="result" class="result-area">
							<div class="result-title" id="resultTitle">ğŸ“‹ å¤„ç†ç»“æœ</div>
							<div class="result-content" id="resultContent"></div>
						</div>
					</form>
				</div>
			</div>

			<div class="tips-section">
				<div class="tips-title">
					<span>ğŸ’¡</span>
					ä½¿ç”¨è¯´æ˜
				</div>
				<ul class="tips-list">
					<li>åœ¨æŠ–éŸ³ App ä¸­æ‰¾åˆ°æƒ³è¦çš„è§†é¢‘ï¼Œç‚¹å‡»"åˆ†äº«"æŒ‰é’®</li>
					<li>é€‰æ‹©"å¤åˆ¶é“¾æ¥"ï¼Œç„¶åå°†å®Œæ•´å†…å®¹ç²˜è´´åˆ°ä¸Šæ–¹æ–‡æœ¬æ¡†</li>
					<li>ç‚¹å‡»"è§£æè§†é¢‘"è·å–è§†é¢‘ä¿¡æ¯</li>
				</ul>
			</div>

			<div class="footer">
				<p>Â© 2024 æŠ–éŸ³è§†é¢‘è§£æå™¨</p>
			</div>
		</div>

		<script>
			// è®¾ç½®æŒ‰é’®åŠ è½½çŠ¶æ€
			function setButtonLoading(buttonId, spinnerId, iconId, textId, loading, loadingText) {
				const button = document.getElementById(buttonId)
				const spinner = document.getElementById(spinnerId)
				const icon = document.getElementById(iconId)
				const text = document.getElementById(textId)

				if (loading) {
					button.disabled = true
					spinner.style.display = 'block'
					icon.style.display = 'none'
					text.textContent = loadingText
				} else {
					button.disabled = false
					spinner.style.display = 'none'
					icon.style.display = 'block'
					text.textContent = loadingText.replace('ä¸­...', '').replace('æ­£åœ¨', '')
				}
			}

			// æ˜¾ç¤ºç»“æœ
			function showResult(title, content, isError = false) {
				const resultArea = document.getElementById('result')
				const resultTitle = document.getElementById('resultTitle')
				const resultContent = document.getElementById('resultContent')

				resultTitle.innerHTML = title
				resultContent.textContent = content

				if (isError) {
					resultArea.classList.add('error')
				} else {
					resultArea.classList.remove('error')
				}

				resultArea.style.display = 'block'
				resultArea.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
			}

			// æ˜¾ç¤ºå›¾ç‰‡æ–¹æ³•
			function showImages(imageUrls = []) {
				const gallery = document.getElementById('imageGallery')
				const grid = document.getElementById('galleryGrid')
				grid.innerHTML = '' // æ¸…ç©ºæ—§å†…å®¹

				if (imageUrls.length === 0) {
					gallery.style.display = 'none'
					return
				}

				imageUrls.forEach((url) => {
					const img = document.createElement('img')
					img.src = url
					grid.appendChild(img)
				})

				gallery.style.display = 'block'
				gallery.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
			}

			// è§£æè§†é¢‘å‡½æ•°
			async function parseVideo() {
				const shareText = document.getElementById('shareText').value.trim()
				if (!shareText) {
					alert('è¯·è¾“å…¥æŠ–éŸ³åˆ†äº«å†…å®¹ï¼')
					document.getElementById('shareText').focus()
					return
				}

				setButtonLoading(
					'parseBtn',
					'parseSpinner',
					'parseIcon',
					'parseText',
					true,
					'æ­£åœ¨è§£æä¸­...'
				)
				showResult('ğŸ”„ è§£æçŠ¶æ€', 'æ­£åœ¨è§£æè§†é¢‘ä¿¡æ¯ï¼Œè¯·ç¨å€™...')

				try {
					const response = await fetch('/api/parse', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/x-www-form-urlencoded',
							Accept: 'application/json'
						},
						body: `shareText=${encodeURIComponent(shareText)}`
					})

					if (!response.ok) {
						const errorText = await response.text()
						throw new Error(`æœåŠ¡å™¨é”™è¯¯ (${response.status}): ${errorText}`)
					}

					const result = await response.json()

					if (result.success) {
						showResult('âœ… è§£ææˆåŠŸ', JSON.stringify(result, null, 2))
						console.log('è§£æç»“æœ:', result)

						if (result.data.aweme_type == 2) {
							// æ˜¾ç¤ºå›¾ç‰‡
							showImages(result.data.allImg)
						}

						if (result.data.aweme_type == 4) {
							// æ˜¾ç¤ºå°é¢
							showImages(result.data.cover)
						}
					} else {
						showResult('âŒ è§£æå¤±è´¥', result.message || 'è§£æè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯', true)
					}
				} catch (error) {
					console.error('Parse error:', error)
					showResult(
						'âŒ è§£æå¤±è´¥',
						`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${error.message}\n\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•`,
						true
					)
				} finally {
					setButtonLoading(
						'parseBtn',
						'parseSpinner',
						'parseIcon',
						'parseText',
						false,
						'è§£æè§†é¢‘'
					)
				}
			}

			// é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
			document.addEventListener('DOMContentLoaded', function () {
				document.getElementById('shareText').focus()
				document.addEventListener('keydown', function (e) {
					if (e.ctrlKey && e.key === 'Enter') {
						parseVideo()
					}
				})
			})
		</script>
	</body>
</html>
