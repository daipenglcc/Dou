<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>æŠ–éŸ³è§†é¢‘ä¸‹è½½å™¨</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
				background: linear-gradient(135deg, #667eea, #764ba2);
				min-height: 100vh;
				color: #333;
				padding: 20px;
			}

			.container {
				max-width: 800px;
				margin: 0 auto;
			}

			/* å¤´éƒ¨æ ·å¼ */
			.header {
				text-align: center;
				margin-bottom: 40px;
				color: white;
			}

			.logo {
				font-size: 3rem;
				margin-bottom: 15px;
			}

			.title {
				font-size: 2.5rem;
				font-weight: 700;
				margin-bottom: 10px;
			}

			.subtitle {
				opacity: 0.8;
				font-size: 1.1rem;
			}

			/* å¡ç‰‡æ ·å¼ */
			.card {
				background: rgba(255, 255, 255, 0.15);
				backdrop-filter: blur(20px);
				border-radius: 20px;
				border: 1px solid rgba(255, 255, 255, 0.2);
				padding: 30px;
				margin-bottom: 30px;
				box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
			}

			/* è¡¨å•æ ·å¼ */
			.form-group {
				margin-bottom: 25px;
			}

			.label {
				color: rgba(255, 255, 255, 0.9);
				font-weight: 600;
				margin-bottom: 10px;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.input {
				width: 100%;
				padding: 15px 20px;
				border: 2px solid rgba(255, 255, 255, 0.2);
				border-radius: 15px;
				background: rgba(255, 255, 255, 0.1);
				color: white;
				font-size: 1rem;
				transition: all 0.3s ease;
				min-height: 120px;
				resize: vertical;
			}

			.input:focus {
				outline: none;
				border-color: rgba(255, 255, 255, 0.5);
				background: rgba(255, 255, 255, 0.15);
			}

			.input::placeholder {
				color: rgba(255, 255, 255, 0.5);
			}

			/* æŒ‰é’®æ ·å¼ */
			.btn {
				width: 100%;
				padding: 15px;
				border: none;
				border-radius: 15px;
				font-size: 1.1rem;
				font-weight: 600;
				cursor: pointer;
				transition: all 0.3s ease;
				display: flex;
				align-items: center;
				justify-content: center;
				gap: 10px;
			}

			.btn-primary {
				background: linear-gradient(135deg, #ff6b6b, #ee5a24);
				color: white;
			}

			.btn-primary:hover:not(:disabled) {
				transform: translateY(-2px);
				box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
			}

			.btn-success {
				background: linear-gradient(135deg, #10ac84, #00d2d3);
				color: white;
			}

			.btn-success:hover {
				transform: translateY(-2px);
			}

			.btn:disabled {
				opacity: 0.7;
				cursor: not-allowed;
			}

			/* åŠ è½½åŠ¨ç”» */
			.spinner {
				width: 20px;
				height: 20px;
				border: 2px solid rgba(255, 255, 255, 0.3);
				border-top: 2px solid white;
				border-radius: 50%;
				animation: spin 1s linear infinite;
			}

			@keyframes spin {
				0% {
					transform: rotate(0deg);
				}
				100% {
					transform: rotate(360deg);
				}
			}

			/* ç»“æœå±•ç¤ºåŒºåŸŸ */
			.results {
				margin-top: 30px;
			}

			.result-header {
				color: white;
				font-weight: 600;
				font-size: 1.2rem;
				margin-bottom: 20px;
				display: flex;
				align-items: center;
				gap: 10px;
			}

			/* åª’ä½“é¢„è§ˆæ ·å¼ */
			.media-preview {
				background: rgba(255, 255, 255, 0.05);
				border-radius: 15px;
				padding: 20px;
				margin-bottom: 20px;
			}

			.video-container {
				position: relative;
				border-radius: 15px;
				overflow: hidden;
				margin-bottom: 20px;
			}

			.video-cover {
				width: 100%;
				height: 300px;
				object-fit: cover;
			}

			.play-btn {
				position: absolute;
				top: 50%;
				left: 50%;
				transform: translate(-50%, -50%);
				width: 60px;
				height: 60px;
				background: rgba(255, 255, 255, 0.9);
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 1.5rem;
			}

			/* å›¾ç‰‡ç½‘æ ¼ */
			.image-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 15px;
				margin-bottom: 20px;
			}

			.image-item {
				border-radius: 10px;
				overflow: hidden;
				transition: transform 0.3s ease;
				cursor: pointer;
			}

			.image-item:hover {
				transform: scale(1.05);
			}

			.image-item img {
				width: 100%;
				height: auto;
				display: block;
			}

			/* ä¿¡æ¯å±•ç¤º */
			.info-display {
				background: rgba(255, 255, 255, 0.1);
				border-radius: 15px;
				padding: 20px;
				color: white;
				white-space: pre-wrap;
				font-family: monospace;
				font-size: 0.9rem;
				line-height: 1.4;
				max-height: 300px;
				overflow-y: auto;
			}

			.error {
				background: rgba(255, 107, 107, 0.2);
				border: 1px solid rgba(255, 107, 107, 0.3);
				color: #ffcccb;
			}

			/* ä½¿ç”¨è¯´æ˜ */
			.tips {
				background: rgba(255, 255, 255, 0.1);
				border-radius: 20px;
				padding: 30px;
				color: white;
			}

			.tips h3 {
				margin-bottom: 15px;
				display: flex;
				align-items: center;
				gap: 8px;
			}

			.tips ul {
				list-style: none;
			}

			.tips li {
				margin-bottom: 10px;
				display: flex;
				align-items: flex-start;
				gap: 10px;
				line-height: 1.5;
			}

			.tips li::before {
				content: 'âœ¨';
				flex-shrink: 0;
			}

			/* å“åº”å¼ */
			@media (max-width: 768px) {
				.title {
					font-size: 2rem;
				}

				.card {
					padding: 20px;
				}

				.work-meta {
					grid-template-columns: repeat(2, 1fr);
				}
			}

			/* Vueè¿‡æ¸¡ */
			.fade-enter-active,
			.fade-leave-active {
				transition: opacity 0.5s ease;
			}

			.fade-enter-from,
			.fade-leave-to {
				opacity: 0;
			}

			.slide-enter-active {
				transition: all 0.4s ease-out;
			}

			.slide-enter-from {
				opacity: 0;
				transform: translateY(20px);
			}
		</style>
	</head>
	<body>
		<div id="app">
			<div class="container">
				<!-- å¤´éƒ¨ -->
				<div class="header">
					<div class="logo">ğŸµ</div>
					<h1 class="title">æŠ–éŸ³è§†é¢‘ä¸‹è½½å™¨</h1>
					<p class="subtitle">å¿«é€Ÿè§£æå¹¶ä¸‹è½½æŠ–éŸ³è§†é¢‘ï¼Œæ”¯æŒæ— æ°´å°ä¸‹è½½</p>
				</div>

				<!-- ä¸»è¦è¡¨å• -->
				<div class="card">
					<form @submit.prevent="parseVideo">
						<div class="form-group">
							<label class="label">
								<span>ğŸ“±</span>
								è¾“å…¥æŠ–éŸ³åˆ†äº«é“¾æ¥
							</label>
							<textarea
								v-model="shareText"
								class="input"
								placeholder="è¯·ç²˜è´´å®Œæ•´çš„æŠ–éŸ³åˆ†äº«å†…å®¹æˆ–é“¾æ¥..."
								required
								ref="textareaRef"
							></textarea>
						</div>

						<button
							type="button"
							class="btn btn-primary"
							@click="parseVideo"
							:disabled="isLoading"
						>
							<div v-show="isLoading" class="spinner"></div>
							<span v-show="!isLoading">ğŸ”</span>
							<span>{{ isLoading ? 'æ­£åœ¨è§£æ...' : 'è§£æè§†é¢‘' }}</span>
						</button>
					</form>
				</div>

				<!-- è§£æç»“æœ -->
				<transition name="slide">
					<div v-show="showResults" class="results">
						<!-- è§†é¢‘é¢„è§ˆ -->
						<transition name="fade">
							<div v-show="videoData" class="card">
								<div class="result-header">
									<span>ğŸ¬</span>
									è§†é¢‘é¢„è§ˆ
								</div>
								<div class="media-preview">
									<div class="video-container">
										<img
											:src="videoData?.coverUrl"
											class="video-cover"
											alt="è§†é¢‘å°é¢"
										/>
										<div class="play-btn">â–¶ï¸</div>
									</div>
									<button class="btn btn-success" @click="downloadVideo">
										<span>ğŸ“¥</span>
										ä¸‹è½½è§†é¢‘
									</button>
								</div>
							</div>
						</transition>

						<!-- å›¾ç‰‡é¢„è§ˆ -->
						<transition name="fade">
							<div v-show="imageData && imageData.length > 0" class="card">
								<div class="result-header">
									<span>ğŸ–¼ï¸</span>
									å›¾ç‰‡é¢„è§ˆ ({{ imageData.length }}å¼ )
								</div>
								<div class="media-preview">
									<div class="image-grid">
										<div
											v-for="(image, index) in imageData"
											:key="index"
											class="image-item"
											@click="previewImage(image)"
										>
											<img
												:src="image"
												:alt="`å›¾ç‰‡ ${index + 1}`"
												loading="lazy"
											/>
										</div>
									</div>
									<div style="opacity: 0.7; font-size: 0.9rem">
										ğŸ’¡ ç‚¹å‡»å›¾ç‰‡é¢„è§ˆï¼Œå³é”®ä¿å­˜åˆ°æœ¬åœ°
									</div>
								</div>
							</div>
						</transition>

						<!-- è¯¦ç»†ä¿¡æ¯ -->
						<transition name="fade">
							<div v-show="infoData" class="card">
								<div class="result-header">
									<span>{{ infoData?.isError ? 'âŒ' : 'ğŸ“‹' }}</span>
									<span>{{ infoData?.title || 'è¯¦ç»†ä¿¡æ¯' }}</span>
								</div>
								<div class="info-display" :class="{ 'error': infoData?.isError }">
									{{ infoData?.content }}
								</div>
							</div>
						</transition>
					</div>
				</transition>

				<!-- ä½¿ç”¨è¯´æ˜ -->
				<div class="card tips">
					<h3>
						<span>ğŸ’¡</span>
						ä½¿ç”¨è¯´æ˜
					</h3>
					<ul>
						<li>åœ¨æŠ–éŸ³APPä¸­æ‰¾åˆ°è§†é¢‘ï¼Œç‚¹å‡»åˆ†äº«æŒ‰é’®</li>
						<li>é€‰æ‹©"å¤åˆ¶é“¾æ¥"ï¼Œç²˜è´´åˆ°ä¸Šæ–¹è¾“å…¥æ¡†</li>
						<li>ç‚¹å‡»è§£ææŒ‰é’®ï¼ŒæŸ¥çœ‹ä½œå“ä¿¡æ¯å’Œé¢„è§ˆ</li>
						<li>è§†é¢‘å¯ä¸€é”®ä¸‹è½½ï¼Œå›¾ç‰‡å¯å³é”®ä¿å­˜</li>
					</ul>
				</div>
			</div>
		</div>

		<!-- Vue 3 CDN -->
		<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
		<script>
			const { createApp, ref, onMounted, nextTick } = Vue

			createApp({
				setup() {
					// å“åº”å¼æ•°æ®
					const shareText = ref('')
					const isLoading = ref(false)
					const showResults = ref(false)
					const videoData = ref(null)
					const imageData = ref([])
					const infoData = ref(null)
					const textareaRef = ref(null)

					// æ ¼å¼åŒ–æ•°å­—
					const formatCount = (count) => {
						if (!count) return '0'
						if (count >= 10000) {
							return (count / 10000).toFixed(1) + 'w'
						}
						return count.toString()
					}

					// æ¸…ç†ç»“æœ
					const clearResults = () => {
						videoData.value = null
						imageData.value = []
						infoData.value = null
					}

					// æ»šåŠ¨åˆ°ç»“æœ
					const scrollToResults = () => {
						nextTick(() => {
							const results = document.querySelector('.results')
							if (results) {
								results.scrollIntoView({ behavior: 'smooth', block: 'nearest' })
							}
						})
					}

					// æ˜¾ç¤ºä¿¡æ¯
					const showInfo = (title, content, isError = false) => {
						infoData.value = { title, content, isError }
						showResults.value = true
						scrollToResults()
					}

					// æ˜¾ç¤ºè§†é¢‘
					const showVideo = (coverUrl, downloadUrl) => {
						videoData.value = { coverUrl, downloadUrl }
						showResults.value = true
						scrollToResults()
					}

					// æ˜¾ç¤ºå›¾ç‰‡
					const showImages = (images) => {
						imageData.value = images
						showResults.value = true
						scrollToResults()
					}

					// é¢„è§ˆå›¾ç‰‡
					const previewImage = (imageUrl) => {
						window.open(imageUrl, '_blank')
					}

					// ä¸‹è½½è§†é¢‘
					const downloadVideo = () => {
						if (videoData.value?.downloadUrl) {
							window.open(videoData.value.downloadUrl, '_blank')
						}
					}

					// è§£æè§†é¢‘
					const parseVideo = async () => {
						const text = shareText.value.trim()
						if (!text) {
							alert('è¯·è¾“å…¥æŠ–éŸ³åˆ†äº«å†…å®¹ï¼')
							textareaRef.value?.focus()
							return
						}

						isLoading.value = true
						clearResults()
						showInfo('è§£æä¸­', 'æ­£åœ¨è§£æè§†é¢‘ä¿¡æ¯ï¼Œè¯·ç¨å€™...')

						try {
							const response = await fetch('/api/parse', {
								method: 'POST',
								headers: {
									'Content-Type': 'application/x-www-form-urlencoded',
									Accept: 'application/json'
								},
								body: `shareText=${encodeURIComponent(text)}`
							})

							if (!response.ok) {
								const errorText = await response.text()
								throw new Error(`æœåŠ¡å™¨é”™è¯¯ (${response.status}): ${errorText}`)
							}

							const result = await response.json()

							if (result.success) {
								const data = result.data

								// æ ¹æ®ç±»å‹æ˜¾ç¤ºå†…å®¹
								if (data.aweme_type == 2 && data.allImg && data.allImg.length > 0) {
									// å›¾ç‰‡
									showImages(data.allImg)
									infoData.value = null // æ¸…é™¤loadingä¿¡æ¯
								} else if (data.aweme_type == 4 && data.cover) {
									// è§†é¢‘
									const coverUrl = Array.isArray(data.cover)
										? data.cover[0]
										: data.cover
									const videoUrl = data.url
									showVideo(coverUrl, videoUrl)
									infoData.value = null // æ¸…é™¤loadingä¿¡æ¯
								} else {
									// æ˜¾ç¤ºåŸå§‹æ•°æ®
									showInfo('è§£æå®Œæˆ', JSON.stringify(result, null, 2))
								}
							} else {
								clearResults()
								showInfo('è§£æå¤±è´¥', result.message || 'è§£æè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯', true)
							}
						} catch (error) {
							console.error('Parse error:', error)
							clearResults()
							showInfo(
								'è§£æå¤±è´¥',
								`ç½‘ç»œè¯·æ±‚å¤±è´¥: ${error.message}\n\nè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•`,
								true
							)
						} finally {
							isLoading.value = false
						}
					}

					// é”®ç›˜äº‹ä»¶
					const handleKeydown = (e) => {
						if (e.ctrlKey && e.key === 'Enter') {
							parseVideo()
						}
					}

					// åˆå§‹åŒ–
					onMounted(() => {
						textareaRef.value?.focus()
						document.addEventListener('keydown', handleKeydown)
					})

					return {
						shareText,
						isLoading,
						showResults,
						videoData,
						imageData,
						infoData,
						textareaRef,
						formatCount,
						parseVideo,
						downloadVideo,
						previewImage
					}
				}
			}).mount('#app')
		</script>
	</body>
</html>
